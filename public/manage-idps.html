<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Identity Providers - Okta Authentication Flows</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    body {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .page-header h1 {
      color: #fff;
      font-size: 1.5rem;
      margin: 0;
    }

    .btn-back {
      color: #a0c4ff;
      text-decoration: none;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .btn-back:hover {
      color: #fff;
    }

    .idp-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .idp-card {
      background: #fff;
      border-radius: 8px;
      padding: 1.25rem;
      position: relative;
    }

    .idp-card.primary {
      border: 2px solid #4caf50;
    }

    .idp-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
    }

    .idp-card-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .idp-card-title h3 {
      font-size: 1rem;
      margin: 0;
      color: #1a1a2e;
    }

    .badge-primary {
      background: #d1fae5;
      color: #065f46;
      font-size: 0.7rem;
      padding: 0.2rem 0.5rem;
      border-radius: 3px;
      font-weight: 600;
    }

    .idp-card-actions {
      display: flex;
      gap: 0.5rem;
    }

    .idp-fields {
      display: grid;
      gap: 0.75rem;
    }

    .idp-field {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .idp-field label {
      font-size: 0.75rem;
      font-weight: 600;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .idp-field-value {
      font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
      font-size: 0.85rem;
      color: #333;
      background: #f5f5f5;
      padding: 0.5rem 0.75rem;
      border-radius: 4px;
      word-break: break-all;
    }

    .idp-field-value.secret {
      color: #888;
      letter-spacing: 2px;
    }

    .idp-field input {
      font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
      font-size: 0.85rem;
      padding: 0.5rem 0.75rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      width: 100%;
    }

    .idp-field input:focus {
      outline: none;
      border-color: #1976d2;
      box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
    }

    .idp-meta {
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid #eee;
      font-size: 0.75rem;
      color: #888;
      display: flex;
      gap: 1rem;
    }

    .add-idp-card {
      background: rgba(255, 255, 255, 0.05);
      border: 2px dashed rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.15s;
    }

    .add-idp-card:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.3);
    }

    .add-idp-card .icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .add-idp-card p {
      color: #a0a0a0;
      margin: 0;
    }

    /* Edit mode styles */
    .idp-card.editing .view-mode {
      display: none;
    }

    .idp-card:not(.editing) .edit-mode {
      display: none;
    }

    .edit-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    /* Add IdP Form */
    .add-idp-form {
      background: #fff;
      border-radius: 8px;
      padding: 1.25rem;
      display: none;
    }

    .add-idp-form.visible {
      display: block;
    }

    .add-idp-form h3 {
      font-size: 1rem;
      margin: 0 0 1rem;
      color: #1a1a2e;
    }

    .form-row {
      margin-bottom: 0.75rem;
    }

    .form-row label {
      display: block;
      font-size: 0.8rem;
      font-weight: 600;
      color: #555;
      margin-bottom: 0.25rem;
    }

    .form-row input {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 0.85rem;
      font-family: inherit;
    }

    .form-row input:focus {
      outline: none;
      border-color: #1976d2;
      box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
    }

    .form-row .hint {
      font-size: 0.7rem;
      color: #888;
      margin-top: 0.25rem;
    }

    .form-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .callout {
      background: #fff3cd;
      border: 1px solid #ffc107;
      border-radius: 6px;
      padding: 0.75rem 1rem;
      margin: 1rem 0;
      font-size: 0.8rem;
      color: #856404;
    }

    .callout code {
      background: rgba(0, 0, 0, 0.1);
      padding: 0.15rem 0.35rem;
      border-radius: 3px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 0.75rem;
      word-break: break-all;
    }

    .error-message {
      background: #fef2f2;
      border: 1px solid #fca5a5;
      border-radius: 4px;
      padding: 0.5rem 0.75rem;
      color: #b91c1c;
      font-size: 0.8rem;
      margin-top: 0.5rem;
      display: none;
    }

    .error-message.visible {
      display: block;
    }

    .empty-state {
      text-align: center;
      padding: 3rem;
      color: #a0a0a0;
    }

    .empty-state .icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .loading {
      text-align: center;
      padding: 2rem;
      color: #a0a0a0;
    }

    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .checkbox-row input[type="checkbox"] {
      width: auto;
    }

    .checkbox-row label {
      font-size: 0.8rem;
      color: #555;
      margin: 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="page-header">
      <a href="/" class="btn-back">← Back to Flows</a>
      <h1>Manage Identity Providers</h1>
      <div></div>
    </div>

    <div class="idp-list" id="idp-list">
      <div class="loading">Loading...</div>
    </div>

    <!-- Add IdP Card (always at bottom) -->
    <div class="add-idp-card" id="add-idp-trigger">
      <div class="icon">➕</div>
      <p>Add Identity Provider</p>
    </div>

    <!-- Add IdP Form (hidden by default) -->
    <div class="add-idp-form" id="add-idp-form">
      <h3>Add New Identity Provider</h3>

      <div class="form-row">
        <label for="new-name">Name</label>
        <input type="text" id="new-name" placeholder="e.g., Production Okta">
      </div>

      <div class="form-row">
        <label for="new-domain">Authorization Server URL</label>
        <input type="text" id="new-domain" placeholder="https://your-domain.okta.com">
      </div>

      <div class="form-row">
        <label for="new-clientId">Client ID</label>
        <input type="text" id="new-clientId" placeholder="OAuth 2.0 Client ID">
      </div>

      <div class="form-row">
        <label for="new-clientSecret">Client Secret</label>
        <input type="password" id="new-clientSecret" placeholder="OAuth 2.0 Client Secret">
      </div>

      <div class="checkbox-row">
        <input type="checkbox" id="new-isPrimary">
        <label for="new-isPrimary">Set as primary IdP</label>
      </div>

      <div class="callout">
        <strong>Redirect URI:</strong> Add this to your application configuration:<br>
        <code id="redirect-uri"></code>
      </div>

      <div class="error-message" id="add-error"></div>

      <div class="form-actions">
        <button class="btn btn-secondary btn-small" id="cancel-add-btn">Cancel</button>
        <button class="btn btn-primary btn-small" id="save-add-btn">Add IdP</button>
      </div>
    </div>
  </div>

  <script>
    // Check authentication before loading app
    (function() {
      const CURRENT_USER_KEY = 'okta_current_user';
      const SESSION_HOURS = 24;

      function isAuthenticated() {
        const userJson = localStorage.getItem(CURRENT_USER_KEY);
        if (!userJson) return false;
        try {
          const user = JSON.parse(userJson);
          if (!user.authenticatedAt) return false;
          const authTime = new Date(user.authenticatedAt);
          const hoursSinceAuth = (Date.now() - authTime.getTime()) / (1000 * 60 * 60);
          return hoursSinceAuth < SESSION_HOURS;
        } catch { return false; }
      }

      if (!isAuthenticated()) {

      }
    })();
  </script>
  <script src="manage-idps-app.js"></script>
</body>
</html>
