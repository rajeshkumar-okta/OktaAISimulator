"use strict";(()=>{var e={};e.id=723,e.ids=[723],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},9369:e=>{e.exports=import("jose")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},8565:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{config:()=>c,default:()=>s,routeModule:()=>d});var o=n(1802),i=n(7153),l=n(6249),u=n(889),a=e([u]);u=(a.then?(await a)():a)[0];let s=(0,l.l)(u,"default"),c=(0,l.l)(u,"config"),d=new o.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/oauth/authorize",pathname:"/api/oauth/authorize",bundlePath:"",filename:""},userland:u});r()}catch(e){r(e)}})},889:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{default:()=>d});var o=n(4770),i=n.n(o),l=n(9369),u=n(5514),a=n(3022),s=n(4503),c=e([l]);async function d(e,t){if(t.setHeader("Access-Control-Allow-Credentials","true"),t.setHeader("Access-Control-Allow-Origin",e.headers.origin||"*"),t.setHeader("Access-Control-Allow-Methods","GET,OPTIONS,PATCH,DELETE,POST,PUT"),t.setHeader("Access-Control-Allow-Headers","X-CSRF-Token,X-Requested-With,Accept,Accept-Version,Content-Length,Content-MD5,Content-Type,Date,X-Api-Version"),"OPTIONS"===e.method){t.status(200).end();return}if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let n=e.body,r=(0,u.Uw)(n);if(r)return t.status(400).json({error:r});let o=n.sessionType||"auth-code-flow",l=n.userName||null;s.yj(o,l);let c=void 0!==n.step1AuthServerId?n.step1AuthServerId:n.authorizationServerId;s.cM(1,"OAuth Authorize initiated",{oktaDomain:n.oktaDomain,clientId:n.clientId,redirectUri:n.redirectUri,authorizationServerId:c||"(org)",clientAuthMethod:n.clientAuthMethod||"client_secret",responseType:n.responseType||"code"});let d=n.customState||i().randomBytes(16).toString("hex"),h=n.customNonce||i().randomBytes(16).toString("hex"),p=i().randomBytes(32).toString("base64url"),f=Buffer.from(i().createHash("sha256").update(p).digest()).toString("base64url");a.IW({oauthState:d,oauthNonce:h,codeVerifier:p,cfg:n}),s.cM(2,"Generated OAuth parameters",{state:d,nonce:h,codeChallenge:f,pkce:n.usePkce?"enabled":"disabled"});let g=c?`oauth2/${c}/v1`:"oauth2/v1",m=new URLSearchParams({client_id:n.clientId,response_type:n.responseType||"code",scope:n.scope||"openid profile email",redirect_uri:n.redirectUri,state:d,nonce:h,...n.usePkce&&{code_challenge:f,code_challenge_method:"S256"},...n.loginHint&&{login_hint:n.loginHint},...n.idpHint&&{idp:n.idpHint},...n.prompt&&{prompt:n.prompt},...n.maxAge&&{max_age:n.maxAge}}),A=`https://${n.oktaDomain}/${g}/authorize?${m.toString()}`;s.cM(3,"Authorization URL generated",{url:A.replace(/client_id=[^&]+/,"client_id=***")}),t.json({authUrl:A,state:d,nonce:h,codeVerifier:n.usePkce?p:void 0,sessionId:s.iP().sessionId})}catch(e){s.cM(0,"Error in OAuth authorize",{error:e.message}),t.status(500).json({error:e.message})}}l=(c.then?(await c)():c)[0],r()}catch(e){r(e)}})},5514:(e,t,n)=>{function r(e){let t=["oktaDomain","clientId","redirectUri"];"client_secret"===(e.clientAuthMethod||"client_secret")&&t.push("clientSecret");let n=t.filter(t=>!e[t]);return n.length?`Missing required config: ${n.join(", ")}`:null}n.d(t,{Uw:()=>r}),require("dotenv/config"),parseInt(process.env.PORT||"3000",10)},4503:(e,t,n)=>{n.d(t,{Sv:()=>s,cM:()=>l,iP:()=>a,xn:()=>u,yj:()=>i});let r=[],o=null;function i(e="ID-JAG Flow",t=null){let n=new Date;return o={sessionType:e,userName:t,startTime:n.toISOString(),sessionId:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`},r=[],l(0,"Session started",{sessionType:e,userName:t,timestamp:n.toISOString()}),o.sessionId}function l(e,t,n={}){let o={timestamp:new Date().toISOString(),step:e,message:t,data:n};return r.push(o),console.log(`[${e}] ${t}`,JSON.stringify(n)),o}function u(){return r}function a(){return o}function s(){r=[],o=null}},3022:(e,t,n)=>{n.d(t,{IW:()=>i,oA:()=>u,xq:()=>l,y0:()=>o});let r={oauthState:null,oauthNonce:null,codeVerifier:null,cfg:null,idToken:null,accessToken:null,refreshToken:null,idTokenClaims:null,idJagToken:null,idJagResult:null,idJagVerification:null,authServerToken:null,authServerResult:null,authServerVerification:null};function o(){return r}function i(e){return r={...r,...e}}function l(e,t){return r[e]=t,r}function u(){return r={oauthState:null,oauthNonce:null,codeVerifier:null,cfg:null,idToken:null,accessToken:null,refreshToken:null,idTokenClaims:null,idJagToken:null,idJagResult:null,idJagVerification:null,authServerToken:null,authServerResult:null,authServerVerification:null}}},7153:(e,t)=>{var n;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return n}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(n||(n={}))},1802:(e,t,n)=>{e.exports=n(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var n=t(t.s=8565);module.exports=n})();