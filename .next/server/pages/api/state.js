"use strict";(()=>{var e={};e.id=842,e.ids=[842],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},9369:e=>{e.exports=import("jose")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},4810:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{config:()=>c,default:()=>u,routeModule:()=>d});var o=n(1802),i=n(7153),s=n(6249),a=n(7500),l=e([a]);a=(l.then?(await l)():l)[0];let u=(0,s.l)(a,"default"),c=(0,s.l)(a,"config"),d=new o.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/state",pathname:"/api/state",bundlePath:"",filename:""},userland:a});r()}catch(e){r(e)}})},889:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{default:()=>d,oauthStateStore:()=>h});var o=n(4770),i=n.n(o),s=n(9369),a=n(5514),l=n(3022),u=n(4503),c=e([s]);s=(c.then?(await c)():c)[0];let h=new Map;async function d(e,t){if(t.setHeader("Access-Control-Allow-Credentials","true"),t.setHeader("Access-Control-Allow-Origin",e.headers.origin||"*"),t.setHeader("Access-Control-Allow-Methods","GET,OPTIONS,PATCH,DELETE,POST,PUT"),t.setHeader("Access-Control-Allow-Headers","X-CSRF-Token,X-Requested-With,Accept,Accept-Version,Content-Length,Content-MD5,Content-Type,Date,X-Api-Version"),"OPTIONS"===e.method){t.status(200).end();return}if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let n=e.body,r=(0,a.Uw)(n);if(r)return t.status(400).json({error:r});let o=n.sessionType||"auth-code-flow",s=n.userName||null;u.yj(o,s);let c=void 0!==n.step1AuthServerId?n.step1AuthServerId:n.authorizationServerId;u.cM(1,"OAuth Authorize initiated",{oktaDomain:n.oktaDomain,clientId:n.clientId,redirectUri:n.redirectUri,authorizationServerId:c||"(org)",clientAuthMethod:n.clientAuthMethod||"client_secret",responseType:n.responseType||"code"});let d=n.customState||i().randomBytes(16).toString("hex"),p=n.customNonce||i().randomBytes(16).toString("hex"),f=i().randomBytes(32).toString("base64url"),A=Buffer.from(i().createHash("sha256").update(f).digest()).toString("base64url");h.set(d,{oktaDomain:n.oktaDomain,clientId:n.clientId,clientSecret:n.clientSecret,redirectUri:n.redirectUri,authorizationServerId:c,codeVerifier:f,nonce:p,createdAt:Date.now()});let S=Date.now();for(let[e,t]of h.entries())S-t.createdAt>9e5&&h.delete(e);l.IW({oauthState:d,oauthNonce:p,codeVerifier:f,cfg:n}),u.cM(2,"Generated OAuth parameters",{state:d,nonce:p,codeChallenge:A,pkce:"enabled (always)"});let g=c?`oauth2/${c}/v1`:"oauth2/v1",m=n.oktaDomain.replace(/^https?:\/\//,"").replace(/\/$/,""),T=new URLSearchParams({client_id:n.clientId,response_type:n.responseType||"code",scope:n.scope||"openid profile email",redirect_uri:n.redirectUri,state:d,nonce:p,code_challenge:A,code_challenge_method:"S256",...n.loginHint&&{login_hint:n.loginHint},...n.idpHint&&{idp:n.idpHint},...n.prompt&&{prompt:n.prompt},...n.maxAge&&{max_age:n.maxAge}}),P=`https://${m}/${g}/authorize?${T.toString()}`;u.cM(3,"Authorization URL generated",{url:P.replace(/client_id=[^&]+/,"client_id=***")}),t.json({authUrl:P,state:d,nonce:p,codeVerifier:f,sessionId:u.iP().sessionId})}catch(e){u.cM(0,"Error in OAuth authorize",{error:e.message}),t.status(500).json({error:e.message})}}r()}catch(e){r(e)}})},7500:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{default:()=>a});var o=n(3022),i=n(889),s=e([i]);async function a(e,t){if(t.setHeader("Access-Control-Allow-Credentials","true"),t.setHeader("Access-Control-Allow-Origin",e.headers.origin||"*"),t.setHeader("Access-Control-Allow-Methods","GET,OPTIONS,POST,DELETE"),t.setHeader("Access-Control-Allow-Headers","X-CSRF-Token,X-Requested-With,Accept,Accept-Version,Content-Length,Content-MD5,Content-Type,Date,X-Api-Version"),"OPTIONS"===e.method){t.status(200).end();return}try{if("GET"===e.method){let{state:n}=e.query;if(n){let e=i.oauthStateStore.get(n);if(!e)return t.status(404).json({error:"OAuth state not found or expired"});return t.json(e)}t.json(o.y0())}else if("POST"===e.method){let n;let{key:r,value:i,state:s}=e.body;if(s)n=o.IW(s);else{if(!r||void 0===i)return t.status(400).json({error:"Provide either state object or key/value pair"});n=o.xq(r,i)}t.json(n)}else if("DELETE"===e.method){let e=o.oA();t.json({success:!0,state:e})}else t.status(405).json({error:"Method not allowed"})}catch(e){t.status(500).json({error:e.message})}}i=(s.then?(await s)():s)[0],r()}catch(e){r(e)}})},5514:(e,t,n)=>{function r(e){let t=["oktaDomain","clientId","redirectUri"];"client_secret"===(e.clientAuthMethod||"client_secret")&&t.push("clientSecret");let n=t.filter(t=>!e[t]);return n.length?`Missing required config: ${n.join(", ")}`:null}n.d(t,{Uw:()=>r}),require("dotenv/config"),parseInt(process.env.PORT||"3000",10)},4503:(e,t,n)=>{n.d(t,{Sv:()=>u,cM:()=>s,iP:()=>l,xn:()=>a,yj:()=>i});let r=[],o=null;function i(e="ID-JAG Flow",t=null){let n=new Date;return o={sessionType:e,userName:t,startTime:n.toISOString(),sessionId:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`},r=[],s(0,"Session started",{sessionType:e,userName:t,timestamp:n.toISOString()}),o.sessionId}function s(e,t,n={}){let o={timestamp:new Date().toISOString(),step:e,message:t,data:n};return r.push(o),console.log(`[${e}] ${t}`,JSON.stringify(n)),o}function a(){return r}function l(){return o}function u(){r=[],o=null}},3022:(e,t,n)=>{n.d(t,{IW:()=>i,oA:()=>a,xq:()=>s,y0:()=>o});let r={oauthState:null,oauthNonce:null,codeVerifier:null,cfg:null,idToken:null,accessToken:null,refreshToken:null,idTokenClaims:null,idJagToken:null,idJagResult:null,idJagVerification:null,authServerToken:null,authServerResult:null,authServerVerification:null};function o(){return r}function i(e){return r={...r,...e}}function s(e,t){return r[e]=t,r}function a(){return r={oauthState:null,oauthNonce:null,codeVerifier:null,cfg:null,idToken:null,accessToken:null,refreshToken:null,idTokenClaims:null,idJagToken:null,idJagResult:null,idJagVerification:null,authServerToken:null,authServerResult:null,authServerVerification:null}}},7153:(e,t)=>{var n;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return n}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(n||(n={}))},1802:(e,t,n)=>{e.exports=n(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var n=t(t.s=4810);module.exports=n})();