(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[480],{5700:function(e,t,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/callback",function(){return o(9485)}])},9485:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return r}});var n=o(5893),a=o(7294);function r(){return(0,a.useEffect)(()=>{(async()=>{try{let e=new URLSearchParams(window.location.search),t=e.get("code"),o=e.get("state"),n=e.get("error"),a=e.get("error_description");if(console.log("[Callback] OAuth response:",{code:t?"present":null,state:o,error:n}),n)throw Error("".concat(n,": ").concat(a||"Unknown error"));if(!t)throw Error("No authorization code received");console.log("[Callback] Fetching OAuth state from server...");let r=await fetch("/api/state?state=".concat(encodeURIComponent(o)));if(!r.ok)throw Error("Failed to get OAuth state: ".concat(r.status));let i=await r.json(),s=i.oktaDomain,c=i.clientId,l=i.clientSecret,d=i.redirectUri,h=i.authorizationServerId,p=i.codeVerifier;if(console.log("[Callback] Retrieved OAuth state:",{state:o,oktaDomain:s,clientId:c,clientSecret:l?"present":"MISSING",redirectUri:d,authServerId:h,codeVerifier:p?"present":"MISSING"}),!s||!c||!d)throw Error("Missing required OAuth parameters from state");console.log("[Callback] Exchanging code for tokens...");let g=await fetch("/api/oauth/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:t,state:o,oktaDomain:s,clientId:c,clientSecret:l,redirectUri:d,authorizationServerId:h,codeVerifier:p})});if(!g.ok){let e=await g.json();throw Error(e.error||"Token exchange failed with status ".concat(g.status))}let u=await g.json();console.log("[Callback] Token exchange successful!");let f={type:"oauth-callback",success:!0,code:t,state:o,idToken:u.idToken,accessToken:u.accessToken,refreshToken:u.refreshToken,expiresIn:u.expiresIn,receivedAt:new Date().toISOString()};try{let e=new BroadcastChannel("oauth-callback");e.postMessage(f),console.log("[Callback] Message sent via BroadcastChannel"),e.close()}catch(e){console.log("[Callback] BroadcastChannel failed:",e.message),window.opener&&(window.opener.postMessage(f,window.location.origin),console.log("[Callback] Message sent via postMessage"))}setTimeout(()=>{console.log("[Callback] Closing popup"),window.close()},1e3)}catch(t){console.error("[Callback] Error:",t.message);let e={type:"oauth-callback",success:!1,error:t.message,receivedAt:new Date().toISOString()};try{let t=new BroadcastChannel("oauth-callback");t.postMessage(e),t.close()}catch(t){window.opener&&window.opener.postMessage(e,window.location.origin)}setTimeout(()=>{window.close()},2e3)}})()},[]),(0,n.jsx)("div",{style:i.container,children:(0,n.jsxs)("div",{style:i.card,children:[(0,n.jsx)("div",{style:i.spinner}),(0,n.jsx)("h2",{style:i.title,children:"Processing OAuth Callback"}),(0,n.jsx)("p",{style:i.text,children:"Exchanging authorization code for tokens..."}),(0,n.jsx)("p",{style:{...i.text,fontSize:"12px",color:"#666",marginTop:"20px"},children:"This window will close automatically."})]})})}let i={container:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'},card:{background:"white",padding:"40px",borderRadius:"8px",boxShadow:"0 10px 40px rgba(0, 0, 0, 0.2)",textAlign:"center",maxWidth:"400px"},spinner:{width:"50px",height:"50px",border:"4px solid #f3f3f3",borderTop:"4px solid #667eea",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 20px"},title:{margin:"0 0 10px 0",color:"#333",fontSize:"20px",fontWeight:"600"},text:{margin:"10px 0",color:"#666",fontSize:"14px"}};if("undefined"!=typeof document){let e=document.createElement("style");e.textContent="\n    @keyframes spin {\n      0% { transform: rotate(0deg); }\n      100% { transform: rotate(360deg); }\n    }\n  ",document.head.appendChild(e)}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=5700)}),_N_E=e.O()}]);